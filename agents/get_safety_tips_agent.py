import re 
import json 
from langchain.agents import initialize_agent, AgentType # type: ignore 
from langchain.tools import tool # type: ignore 
from llm import llm # type: ignore 

emergency_tips = {
    "CIVIL": [
        "Ø§Ù„ØªØ²Ù… Ø¨Ù…ÙƒØ§Ù† Ø¢Ù…Ù† Ø¨Ø¹ÙŠØ¯ Ø¹Ù† Ø§Ù„Ù†ÙˆØ§ÙØ° Ø£Ùˆ Ø§Ù„Ø£Ø´Ø¬Ø§Ø±.",
        "Ø§Ø³ØªÙ„Ù‚ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø±Ø¶ ÙˆØºØ·ÙŠ Ø±Ø£Ø³Ùƒ Ù„Ø­Ù…Ø§ÙŠØªÙƒ Ù…Ù† Ø§Ù„Ø£Ø´ÙŠØ§Ø¡ Ø§Ù„Ù…ØªØ³Ø§Ù‚Ø·Ø©.",
        "Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù„Ø¬Ø£ Ø¢Ù…Ù† Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ù†Ø²Ù„.",
        "Ø§ÙØµÙ„ Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡ ÙˆØ§Ù„Ù…ÙŠØ§Ù‡ Ø¥Ø°Ø§ Ø£Ù…ÙƒÙ†.",
        "Ù„Ø§ ØªØ­Ø§ÙˆÙ„ Ø¹Ø¨ÙˆØ± Ø§Ù„Ø·Ø±Ù‚ Ø§Ù„Ù…ØºÙ…ÙˆØ±Ø© Ø¨Ø§Ù„Ù…ÙŠØ§Ù‡.",
        "Ø¥Ø°Ø§ ÙƒÙ†Øª ÙÙŠ Ø§Ù„Ø³ÙŠØ§Ø±Ø©ØŒ ØªÙˆÙ‚Ù Ø¨Ø¹ÙŠØ¯Ø§Ù‹ Ø¹Ù† Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ ÙˆØ§Ù„Ø£Ø´Ø¬Ø§Ø± ÙˆØ§Ø¨Ù‚ÙŽ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø³ÙŠØ§Ø±Ø©.",
        "ØªØ¬Ù†Ø¨ Ù…Ù„Ø§Ù…Ø³Ø© Ø§Ù„Ø£Ø³Ù„Ø§Ùƒ Ø£Ùˆ Ø§Ù„Ù…ÙŠØ§Ù‡ Ø§Ù„Ù…ÙƒØ´ÙˆÙØ©.",
        "Ù„Ø§ ØªÙ‚ØªØ±Ø¨ Ù…Ù† Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ù…ØªØµØ¯Ø¹Ø© Ø£Ùˆ Ø§Ù„Ù…Ù‡Ø¯Ø¯Ø© Ø¨Ø§Ù„Ø§Ù†Ù‡ÙŠØ§Ø±.",
        "Ø­Ø°Ø± Ø§Ù„Ø¢Ø®Ø±ÙŠÙ† ÙÙŠ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø¥Ø°Ø§ ÙˆÙØ¬Ø¯ Ø®Ø·Ø± Ù…Ø¨Ø§Ø´Ø±.",
        "ØªØ¬Ù†Ø¨ Ù„Ù…Ø³ Ø£ÙŠ Ù…ÙˆØ§Ø¯ Ø£Ùˆ Ù…Ø¹Ø¯Ø§Øª Ù…Ø´ØªØ¨Ù‡ Ø¨Ù‡Ø§.",
        "Ø§Ù„ØªÙ‚Ø· ØµÙˆØ±Ù‹Ø§ Ø£Ùˆ Ù…Ù‚Ø§Ø·Ø¹ ÙÙŠØ¯ÙŠÙˆ Ù„Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…ØªØ¶Ø±Ø±Ø©.",
        "Ø§Ø¨Ù‚ÙŽ Ù‚Ø±ÙŠØ¨Ù‹Ø§ Ù…Ù† Ù…ÙˆÙ‚Ø¹ Ø¢Ø®Ø± Ù…Ø´Ø§Ù‡Ø¯Ø© Ù„Ù„Ø´Ø®Øµ Ø§Ù„Ù…ÙÙ‚ÙˆØ¯.",
        "Ù‚Ù… Ø¨ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø¥Ø³Ø¹Ø§ÙØ§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø¥Ø°Ø§ ÙƒÙ†Øª Ù…Ø¯Ø±Ø¨Ù‹Ø§ Ø¹Ù„Ù‰ Ø°Ù„ÙƒØŒ Ø£Ùˆ Ø§ØªØµÙ„ Ø¨Ø§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ù…Ø®ØªØµØ©.",
        "Ù‚Ø¯Ù… Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ù†ÙØ³ÙŠ ÙˆØ§Ù„Ù…Ø¹Ù†ÙˆÙŠ Ù„Ù„Ù…ØªØ¶Ø±Ø±ÙŠÙ† ÙˆØ·Ù…Ø£Ù†Ù‡Ù….",
        "Ù„Ø§ ØªÙ†Ø´Ø± Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ù…ÙÙ‚ÙˆØ¯ Ù‚Ø¨Ù„ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ù…Ø¹ Ø§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ø±Ø³Ù…ÙŠØ©.",
        "Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø®Ø·Ø± Ù…Ø¨Ø§Ø´Ø±ØŒ Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…ÙƒØ§Ù† Ø¢Ù…Ù† Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø¡ Ø£Ùˆ Ø§Ù„Ø¥ÙŠÙˆØ§Ø¡.",
        "ØªØ£ÙƒØ¯ Ù…Ù† ØªØ´ØºÙŠÙ„ Ø£Ø¶ÙˆØ§Ø¡ Ø§Ù„ØªØ­Ø°ÙŠØ± (Ø§Ù„ÙÙ„Ø´Ø±) Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©.",
        "Ù‚Ù… Ø¨Ø¥Ø·ÙØ§Ø¡ Ù…Ø­Ø±Ùƒ Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ù„Ù…Ù†Ø¹ Ù†Ø´ÙˆØ¨ Ø­Ø±ÙŠÙ‚.",
        "Ù„Ø§ ØªØ­Ø§ÙˆÙ„ Ù†Ù‚Ù„ Ø§Ù„Ù…ØµØ§Ø¨ÙŠÙ† Ù…Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Ø®Ø·Ø± Ù…Ø¨Ø§Ø´Ø±.",
        "Ø§Ø¨Ù‚ÙŽ ÙÙŠ Ù…ÙƒØ§Ù† Ø¢Ù…Ù† Ø¨Ø¹ÙŠØ¯Ù‹Ø§ Ø¹Ù† Ø§Ù„Ø·Ø±ÙŠÙ‚ Ø¥Ø°Ø§ ÙƒÙ†Øª Ù‚Ø§Ø¯Ø±Ù‹Ø§.",
        "Ø¥Ø°Ø§ Ø£Ù…ÙƒÙ†ØŒ Ù‚Ù… Ø¨ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø­Ø§Ø¯Ø« Ø¨Ø§Ù„ØµÙˆØ± Ø£Ùˆ Ù…Ù‚Ø§Ø·Ø¹ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ."
    ],
    "FIRE": [
        "Ø­Ø§ÙˆÙ„ Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ù‡Ø¯ÙˆØ¦Ùƒ Ù‚Ø¯Ø± Ø§Ù„Ø¥Ù…ÙƒØ§Ù† Ù„Ø§ØªØ®Ø§Ø° Ù‚Ø±Ø§Ø±Ø§Øª Ø³Ù„ÙŠÙ…Ø©.",
        "Ø§Ø¨ØªØ¹Ø¯ ÙÙˆØ±Ù‹Ø§ Ø¹Ù† Ù…ØµØ¯Ø± Ø§Ù„Ø­Ø±ÙŠÙ‚.",
        "Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¯Ø®Ø§Ù† ÙƒØ«ÙŠÙÙ‹Ø§ØŒ Ø§Ù†Ø­Ù†ÙŠ ÙˆØªØ¬Ù†Ø¨ Ø§Ø³ØªÙ†Ø´Ø§Ù‚ Ø§Ù„Ø¯Ø®Ø§Ù†.",
        "Ø£Ø³Ø±Ø¹ Ø¨Ø¥Ø®Ù„Ø§Ø¡ Ø§Ù„Ù…Ø¨Ù†Ù‰ Ø£Ùˆ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…ØµØ§Ø¨Ø©ØŒ Ù…Ø¹ Ø§Ù„Ø­Ø±Øµ Ø¹Ù„Ù‰ Ø¹Ø¯Ù… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ØµØ§Ø¹Ø¯.",
        "Ù„Ø§ ØªØ­Ø§ÙˆÙ„ Ø¥Ø·ÙØ§Ø¡ Ø§Ù„Ø­Ø±ÙŠÙ‚ Ø§Ù„ÙƒØ¨ÙŠØ± Ø¨Ù†ÙØ³Ùƒ.",
        "Ø£ØºÙ„Ù‚ Ù…ØµØ§Ø¯Ø± Ø§Ù„ØºØ§Ø² Ø£Ùˆ Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø°Ù„Ùƒ Ø¢Ù…Ù†Ù‹Ø§.",
        "Ø§Ø¨ØªØ¹Ø¯ Ø¹Ù† Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø§Ù†ÙØ¬Ø§Ø± Ø£Ùˆ Ø§Ù„ØªØ³Ø±Ø¨ ÙÙˆØ±Ù‹Ø§.",
        "Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ù…Ø¨Ù†Ù‰ Ù‚Ø±ÙŠØ¨ØŒ Ø§Ø¯Ø®Ù„ Ø¥Ù„ÙŠÙ‡ ÙˆØ§Ø­Ù…Ù Ù†ÙØ³Ùƒ. Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Ù…Ø¨Ù†Ù‰ØŒ Ø§Ø¨Ø­Ø« Ø¹Ù† Ø£ÙŠ Ø¬Ø³Ù… ØµÙ„Ø¨ ÙŠÙˆÙØ± Ù„Ùƒ Ø¨Ø¹Ø¶ Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ù…Ø«Ù„ Ø¬Ø¯Ø§Ø± Ø£Ùˆ Ù†ÙÙ‚.",
        "Ø§Ø³ØªØ®Ø¯Ù… Ù‚Ø·Ø¹Ø© Ù‚Ù…Ø§Ø´ Ù„ØªØºØ·ÙŠØ© Ø£Ù†ÙÙƒ ÙˆÙÙ…Ùƒ Ù„Ø­Ù…Ø§ÙŠØ© Ù†ÙØ³Ùƒ Ù…Ù† Ø§Ù„ØºØ¨Ø§Ø± Ø£Ùˆ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¦ÙŠØ©.",
        "ØªØ¬Ù†Ø¨ Ø§Ø³ØªÙ†Ø´Ø§Ù‚ Ø§Ù„ØºØ§Ø²Ø§Øª Ø£Ùˆ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø¨ Ù…Ù† Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù…ÙƒØ´ÙˆÙØ©.",
        "Ù„Ø§ ØªØ­Ø§ÙˆÙ„ Ø§Ù„Ù‡Ø±ÙˆØ¨ Ø¨Ø§Ù„Ø³ÙŠØ§Ø±Ø© ÙÙ‚Ø¯ ÙŠØ¤Ø¯ÙŠ Ø§Ù„Ø§Ø²Ø¯Ø­Ø§Ù… Ø¥Ù„Ù‰ ØªÙØ§Ù‚Ù… Ø§Ù„ÙˆØ¶Ø¹.",
        "Ù„Ø§ ØªØ³ØªØ®Ø¯Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø£Ùˆ Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡ ÙÙŠ Ù…Ø­ÙŠØ· Ø§Ù„ØªØ³Ø±Ø¨."
    ],
    "MEDICAL": [
        "Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ù‡Ø¯ÙˆØ¦Ùƒ ÙˆØ·Ù…Ø¦Ù† Ø§Ù„Ù…ØµØ§Ø¨ Ø¥Ù† Ø£Ù…ÙƒÙ†.",
        "Ù„Ø§ ØªØ¹Ø·ÙŠ Ø§Ù„Ù…ØµØ§Ø¨ Ø£ÙŠ Ø·Ø¹Ø§Ù… Ø£Ùˆ Ø´Ø±Ø§Ø¨.",
        "Ø§ÙØªØ­ Ù…Ø¬Ø±Ù‰ Ø§Ù„Ù‡ÙˆØ§Ø¡ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…ØµØ§Ø¨ ÙØ§Ù‚Ø¯Ù‹Ø§ Ù„Ù„ÙˆØ¹ÙŠ.",
        "Ù‚Ø¯Ù… Ø§Ù„Ø¥Ø³Ø¹Ø§ÙØ§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø¥Ù† Ø£Ù…ÙƒÙ†.",
        "Ø±Ø§Ù‚Ø¨ Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ø­ÙŠÙˆÙŠØ© Ø­ØªÙ‰ ÙˆØµÙˆÙ„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©.",
        "Ù„Ø§ ØªØ­Ø§ÙˆÙ„ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø®Ø·ÙŠØ±Ø© Ø¨Ù†ÙØ³Ùƒ Ø¥Ù† Ù„Ù… ØªÙƒÙ† Ù…Ø¯Ø±Ø¨Ù‹Ø§."
    ],
    "POLICE": [
        "Ù„Ø§ ØªØ­Ø§ÙˆÙ„ Ù…ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø³Ø§Ø±Ù‚.",
        "Ù„Ø§ ØªÙ‚Ù… Ø¨Ø£ÙŠ Ø¹Ù…Ù„ Ù…Ù† Ø´Ø£Ù†Ù‡ ØªØ¹Ø±ÙŠØ¶ Ø³Ù„Ø§Ù…ØªÙƒ Ø£Ùˆ Ø³Ù„Ø§Ù…Ø© Ù…Ù† Ù…Ø¹Ùƒ Ø¥Ù„Ù‰ Ø®Ø·Ø±.",
        "Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ù‡Ø¯ÙˆØ¦Ùƒ Ù‚Ø¯Ø± Ø§Ù„Ø¥Ù…ÙƒØ§Ù† ÙÙ‡Ø°Ø§ ÙŠØ³Ø§Ø¹Ø¯Ùƒ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ø£Ù‚Ù„ Ø®Ø³Ø§Ø¦Ø± Ù…Ù…ÙƒÙ†Ø©.",
        "Ø­Ø§ÙˆÙ„ Ø­ÙØ¸ Ù…Ù„Ø§Ù…Ø­ Ø§Ù„Ø¬Ø§Ù†ÙŠ ÙˆØ§ØªØ¬Ø§Ù‡ Ù‡Ø±ÙˆØ¨Ù‡.",
        "Ù„Ø§ ØªÙ„Ù…Ø³ Ø£ÙŠ Ø´ÙŠØ¡ ÙÙŠ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø³Ø±Ù‚Ø© Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¯Ù„Ø©.",
        "Ø§Ø­ØªÙ…Ù ÙÙŠ Ù…ÙƒØ§Ù† Ø¢Ù…Ù† ÙˆÙ„Ø§ ØªØªØ¯Ø®Ù„.",
        "Ø£ØºÙ„Ù‚ Ø§Ù„Ø£Ø¨ÙˆØ§Ø¨ ÙˆØ§Ù„Ù†ÙˆØ§ÙØ° Ø¥Ø°Ø§ ÙƒÙ†Øª ÙÙŠ Ø§Ù„Ù…Ù†Ø²Ù„ Ø£Ùˆ Ù…ØªØ¬Ø±.",
        "Ù„Ø§ ØªØ­Ø§ÙˆÙ„ ØªØµÙˆÙŠØ± Ø£Ùˆ Ù…Ø·Ø§Ø±Ø¯Ø© Ø§Ù„Ø£Ø´Ø®Ø§Øµ Ø§Ù„Ù…Ø³Ù„Ø­ÙŠÙ†.",
        "Ù‚Ù… Ø¨ØªØ¯ÙˆÙŠÙ† ØªÙØ§ØµÙŠÙ„ Ù…Ù‡Ù…Ø© Ù…Ø«Ù„ Ø§Ù„Ø´Ù‡ÙˆØ¯ Ø£Ùˆ Ø§Ù„Ø¸Ø±ÙˆÙ Ø§Ù„Ù…Ø­ÙŠØ·Ø©."
    ]
}

# =============================================================>
@tool
def get_safety_tips(input_text: str) -> str:
    """
    ÙŠÙØ±Ø¬Ø¹ Ù†ØµØ§Ø¦Ø­ Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù†ÙˆØ¹ Ø§Ù„Ø¨Ù„Ø§Øº ÙˆÙ†ÙˆØ¹Ù‡ Ø§Ù„ÙØ±Ø¹ÙŠ ÙˆÙ†Øµ Ø§Ù„Ø¨Ù„Ø§Øº.
    ÙŠØ±Ø¬Ø¹ JSON ÙÙ‚Ø· ÙŠØ­ØªÙˆÙŠ Ù‚Ø§Ø¦Ù…Ø© Ù†ØµØ§Ø¦Ø­ Ø§Ù„Ø³Ù„Ø§Ù…Ø©.
    """
    user_input_match = re.search(r"Ø¨Ù„Ø§Øº Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:\s*(.*)", input_text)
    emergency_type_match = re.search(r"Ù†ÙˆØ¹ Ø§Ù„Ø·Ø§Ø±Ø¦:\s*(.*)", input_text)
    emergency_subtype_match = re.search(r"Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ:\s*(.*)", input_text)
    
    user_input = user_input_match.group(1).strip() if user_input_match else ""
    emergency_type = emergency_type_match.group(1).strip() if emergency_type_match else "UNKNOWN"
    emergency_subtype = emergency_subtype_match.group(1).strip() if emergency_subtype_match else ""
    
    tips_example_list = emergency_tips.get(emergency_type, ["Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØµØ§Ø¦Ø­ Ù…ØªÙˆÙØ±Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ù†ÙˆØ¹ Ù…Ù† Ø§Ù„Ø·ÙˆØ§Ø±Ø¦."])
    tips_prompt = "\n".join([f"- {tip}" for tip in tips_example_list])
    
    prompt = f"""
Ø£Ù†Øª Ù…Ø³Ø§Ø¹Ø¯ Ø·ÙˆØ§Ø±Ø¦ Ø°ÙƒÙŠ Ù…ØªØ®ØµØµ ÙÙŠ ØªÙ‚Ø¯ÙŠÙ… Ø¥Ø±Ø´Ø§Ø¯Ø§Øª Ø§Ù„Ø³Ù„Ø§Ù…Ø© ÙˆØ§Ù„Ø¥Ø³Ø¹Ø§ÙØ§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ©. 
Ø£Ù†Øª Ù‡Ù†Ø§ Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ ÙˆØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ù†ØµØ§Ø¦Ø­ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ø§Ù„ØªÙŠ Ù‚Ø¯ ØªÙ†Ù‚Ø° Ø§Ù„Ø£Ø±ÙˆØ§Ø­.

ðŸ” **ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¨Ù„Ø§Øº:**
- Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ø¨Ù„Øº Ø¹Ù†: {user_input}
- Ù†ÙˆØ¹ Ø§Ù„Ø·Ø§Ø±Ø¦: {emergency_type}
- Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ: {emergency_subtype}

ðŸ“‹ **Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¥Ø±Ø´Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù†ÙˆØ¹ Ø§Ù„Ø·Ø§Ø±Ø¦:**
{tips_prompt}

ðŸŽ¯ **Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ù…Ù†Ùƒ:**
ÙŠØ±Ø¬Ù‰ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ÙˆÙ‚Ù ÙˆØªÙ‚Ø¯ÙŠÙ… Ù†ØµØ§Ø¦Ø­ Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ø£ÙƒØ«Ø± Ù…Ù„Ø§Ø¡Ù…Ø© ÙˆÙˆØ§Ù‚Ø¹ÙŠØ© Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©. 
Ø±ÙƒØ² Ø¹Ù„Ù‰ Ø§Ù„Ù†ØµØ§Ø¦Ø­ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªÙŠ ÙŠÙ…ÙƒÙ† Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… ØªØ·Ø¨ÙŠÙ‚Ù‡Ø§ ÙÙˆØ±Ù‹Ø§.

âœ… **Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø±Ø¯:**
- Ø£Ø¬Ø¨ ÙÙ‚Ø· Ø¨Ù‚Ø§Ø¦Ù…Ø© JSON ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù†ØµØ§Ø¦Ø­ Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©
- Ø§Ø³ØªØ®Ø¯Ù… Ù„ØºØ© ÙˆØ§Ø¶Ø­Ø© ÙˆÙ…Ø¨Ø§Ø´Ø±Ø© ÙˆØ³Ù‡Ù„Ø© Ø§Ù„ÙÙ‡Ù…
- Ø±ØªØ¨ Ø§Ù„Ù†ØµØ§Ø¦Ø­ Ø­Ø³Ø¨ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© ÙˆØ§Ù„Ø£Ù‡Ù…ÙŠØ©
- ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù†ØµØ§Ø¦Ø­ ÙˆØ§Ù‚Ø¹ÙŠØ© ÙˆÙ‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ·Ø¨ÙŠÙ‚

ðŸ“ **Ù…Ø«Ø§Ù„ Ù„Ù„Ø±Ø¯ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:**
[
"Ø§Ù„Ù†ØµÙŠØ­Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ø§Ù„Ø£ÙƒØ«Ø± Ø£Ù‡Ù…ÙŠØ©",
"Ø§Ù„Ù†ØµÙŠØ­Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©",
"Ø§Ù„Ù†ØµÙŠØ­Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©"
]

â›”ï¸ **ØªØ­Ø°ÙŠØ± Ù‡Ø§Ù…:**
- Ù„Ø§ ØªÙƒØªØ¨ Ø£ÙŠ Ø´Ø±Ø­ Ø£Ùˆ Ø¬Ù…Ù„Ø© Ø®Ø§Ø±Ø¬ JSON
- Ù„Ø§ ØªØ¶ÙŠÙ Ø£ÙŠ Ù†Øµ Ø¥Ø¶Ø§ÙÙŠ Ù‚Ø¨Ù„ Ø£Ùˆ Ø¨Ø¹Ø¯ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
- Ø§Ù„ØªØ²Ù… Ø¨Ø´ÙƒÙ„ JSON Ø§Ù„ØµØ­ÙŠØ­ ÙÙ‚Ø·
"""

    response = llm.invoke(prompt)
    print("[ðŸ” raw LLM response]:", response.content)
    
    try:
        match = re.search(r"\[.*?\]", response.content, re.DOTALL)
        if not match:
            raise ValueError("JSON list not found")
        
        safety_tips = json.loads(match.group(0))
        if isinstance(safety_tips, list) and safety_tips:
            return json.dumps(safety_tips, ensure_ascii=False)
        else:
            return json.dumps(["Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØµØ§Ø¦Ø­ Ù…ØªÙˆÙØ±Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ù†ÙˆØ¹ Ù…Ù† Ø§Ù„Ø·ÙˆØ§Ø±Ø¦."], ensure_ascii=False)
    except Exception as e:
        print("[âŒ parsing error]:", e)
        return json.dumps(["ØªØ¹Ø°Ø± ØªØ­Ù„ÙŠÙ„ Ù†ØµØ§Ø¦Ø­ Ø§Ù„Ø³Ù„Ø§Ù…Ø©. ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©."], ensure_ascii=False)

# =============================================================>
# Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¹Ù…ÙŠÙ„
get_safety_tips_agent = initialize_agent(
    tools=[get_safety_tips],
    llm=llm,
    agent=AgentType.OPENAI_FUNCTIONS,
    verbose=False,
)